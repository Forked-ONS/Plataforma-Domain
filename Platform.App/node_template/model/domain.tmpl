const Sequelize = require('sequelize');

const sequelize = new Sequelize('app', 'postgres', '', {
  host: 'localhost',
  dialect: 'postgres',
  pool: {
    max: 5,
    min: 0,
    acquire: 30000,
    idle: 10000
  },
  logging: true,
  operatorsAliases: true
  
});


var model = {};

//Declaring models with Sequelize
{{#each model}}
model["{{@key}}"] = sequelize.define('{{@key}}', {
    {{#join . ","}}
    {{name}}: { type: {{type}} {{#if primaryKey}}, primaryKey: {{primaryKey}}{{/if}}{{#if autoIncrement}}, autoIncrement: {{autoIncrement}}  {{/if}} } {{/join}}
    
},{
    timestamps: true,
    freezeTableName: true    
});

{{/each}}

//Declaring relationship between models

var associations = {};
{{#each relations}}
{{#eq this.[1] "belongsTo"}}
associations["{{0}}.{{2}}"] = model["{{0}}"].{{1}}(model["{{2}}"],{as: '{{2}}', foreignKey: '{{2}}Id'});
{{else}}
associations["{{0}}.{{2}}"] = model["{{0}}"].{{1}}(model["{{2}}"],{as: '{{2}}', foreignKey: '{{0}}Id' });
{{/eq}}
{{/each}}
model["associations"] = associations;

//Sincronize database
sequelize.sync();


module.exports = model;